# QPS与TPS的区别

在高并发系统中，QPS（Queries Per Second）和TPS（Transactions Per Second）是衡量系统性能的两个核心指标，但它们关注的角度不同
## 1. QPS是什么？

- **定义**：系统每秒能够处理的请求（查询）数量，通常指对外的接口请求（如 HTTP 请求）。
- 特点：
  - 关注的是**请求次数**，无论请求是否完整处理。
  - 例如：一个 API 接口每秒被调用 1000 次，QPS 就是 1000。
- 适用场景：
  - 衡量 Web 服务器、API 网关或缓存系统的吞吐量。
  - 例如：Redis 的 QPS 可能高达数十万，因为它处理的是简单的读写操作。

## 2. TPS是什么？

- 定义：系统每秒能够完成的完整事务（Transaction）数量。一个“事务”通常代表一个完整的业务操作（如用户下单、支付等）。
- 特点：
  - 关注的是**完整业务逻辑的执行**，可能涉及多个步骤（如数据库读写、消息发送等）。
  - 例如：用户下单操作可能包含扣减库存、生成订单、支付等步骤，这些步骤整体算作一个事务。
- 适用场景：
  - 衡量数据库（如 MySQL）或核心业务系统（如电商交易系统）的处理能力。
  - 例如：银行系统的 TPS 可能较低（每秒几十到几百），因为事务需要强一致性和持久化。

## 3. 关键区别

| **指标** |         关注点         |   范围   |        示例场景        |
| :------: | :--------------------: | :------: | :--------------------: |
|   QPS    |     请求/查询次数      | 单次操作 | API 接口调用、缓存查询 |
|   TPS    | 完整事务（多步骤组合） | 业务流程 |   订单创建、支付流程   |

## 4. 关系与示例

- **QPS ≥ TPS**：如果一个事务需要多个请求完成（例如下单需要调用多个接口），则 TPS 会小于 QPS。
- **QPS = TPS**：如果每个请求对应一个独立事务（例如简单的查询接口），则两者可能相等。

**示例**：

1. **登录接口**：用户每次登录是一个请求（QPS=1000），但登录本身不涉及多步骤操作（TPS≈1000）。
2. **支付接口**：支付需要验证余额、扣款、记录日志等多个步骤，若每秒完成 200 笔支付，则 TPS=200，但 QPS 可能更高（如每个支付请求包含多个子请求）。

## 5. 高并发系统中的意义

1. **QPS 高**：系统能快速响应大量请求，但需关注是否每个请求都能高效处理（如避免超时）。

2. **TPS 高**：系统能高效完成复杂业务逻辑，但需确保事务的原子性和一致性（如分布式事务）。

3. 瓶颈定位：

   - 若 QPS 高但 TPS 低，可能业务逻辑存在性能问题（如数据库慢查询）。
   
   - 若 TPS 达到瓶颈，需优化事务内流程（如异步化、减少锁竞争）。
   
## 6. 工具与监控

- **QPS 监控**：通过 Prometheus、Nginx 日志、API 网关统计。
- **TPS 监控**：通过业务埋点、数据库事务日志、APM 工具（如 SkyWalking）。
- **压测工具**：使用 JMeter 或 LoadRunner 时，可分别设置 QPS（请求频率）和 TPS（事务控制器）

## 7. 总结

- **QPS** 是系统处理**请求吞吐量**的体现，适用于简单操作的性能评估。
- **TPS** 是系统处理**业务能力**的体现，适用于复杂事务的性能评估。
- 在高并发系统中，需同时关注两者，并结合响应时间（RT）、错误率等指标综合优化。
