# .NET医疗网站 崩溃分析

## 1、背景

监控程序经常发现IIS站点崩溃无响应，将站点下线，导致其他站点压力过大，造成卡顿。

## 2、WinDbg 分析

双击dump文件打开WinDbg，

```
************* Path validation summary **************
Response                         Time (ms)     Location
Deferred                                       srv*
Symbol search path is: srv*
Executable search path is: 
Windows 10 Version 17763 MP (32 procs) Free x64
Product: Server, suite: TerminalServer SingleUserTS
Edition build lab: 17763.1.amd64fre.rs5_release.180914-1434
Debug session time: Tue Jun 10 09:27:42.000 2025 (UTC + 8:00)
System Uptime: 206 days 19:17:58.327
Process Uptime: 0 days 0:00:56.000
................................................................
................................................................
................................................................
................................................................
....................
Loading unloaded module list
....................................

Too many CLR modules are present, stopped after 1000 modules were found. To increase this limit, change the Debug.Advanced.MaxClrModules setting
This dump file has an exception of interest stored in it.
The stored exception information can be accessed via .ecxr
(f50.53cc): Security check failure or stack buffer overrun - code c0000409 (first/second chance not available)
For analysis of this file, run !analyze -v
ntdll!NtWaitForMultipleObjects+0x14:
00007ffe`d3690b24 c3              ret
```

发现了
```
(f50.53cc): Security check failure or stack buffer overrun - code c0000409 (first/second chance not available)
```

然后我们运行一下```!analyze -v```

```
......
省略
......
SYMBOL_NAME:  OraOps12+6739

MODULE_NAME: OraOps12

IMAGE_NAME:  OraOps12.dll

STACK_COMMAND:  ~96s; .ecxr ; kb

BUCKET_ID_MODPRIVATE: 1

FAILURE_BUCKET_ID:  FAIL_FAST_STACK_BUFFER_OVERRUN_c0000409_OraOps12.dll!Unknown

OS_VERSION:  10.0.17763.1

BUILDLAB_STR:  rs5_release

OSPLATFORM_TYPE:  x64

OSNAME:  Windows 10

IMAGE_VERSION:  4.7.3190.0

FAILURE_ID_HASH:  {e2888204-ecb3-c753-a781-79124a7a17a8}

Followup:     MachineOwner
```

看起来应该就是OraOps12.dll导致的堆栈缓冲区溢出。

看一下```lmDvmOraOps12```

```
0:096> lmDvmOraOps12
Browse full module list
start             end                 module name
00007ffe`98500000 00007ffe`9856c000   OraOps12 C (export symbols)       OraOps12.dll
    Loaded symbol image file: OraOps12.dll
    Image path: C:\ODAC\odacx64\product\12.1.0\client_1\bin\OraOps12.dll
    Image name: OraOps12.dll
    Browse all global symbols  functions  data  Symbol Reload
    Timestamp:        Sat Sep 26 23:16:56 2015 (5606B6E8)
    CheckSum:         00000000
    ImageSize:        0006C000
    File version:     2.121.2.0
    Product version:  2.121.2.0
    File flags:       0 (Mask 3F)
    File OS:          4 Unknown Win32
    File type:        2.0 Dll
    File date:        00000000.00000000
    Translations:     0409.04b0
    Information from resource tables:
        CompanyName:      Oracle Corporation
        ProductName:      Oracle Data Provider for .NET
        InternalName:     OraOps
        OriginalFilename: OraOps12.dll
        ProductVersion:   2.121.2.0 ODAC RELEASE 4
        FileVersion:      2.121.2.0
        FileDescription:  Oracle Provider Services
        LegalCopyright:   Copyright © 2014
```

版本还是Sat Sep 26 23:16:56 2015，升级一下版本试试吧

> https://www.cnblogs.com/huangxincheng/p/17248323.html
>
> https://techcommunity.microsoft.com/blog/iis-support-blog/w3wp-exe-crash-exception-code-0xc0000005/334351

